"undefined"==typeof caches?alert('Error: "caches" doesn\'t exist. The browser could be too old or this might be HTTP.'):document.onreadystatechange=(()=>{if("complete"==document.readyState){let e=indexedDB.open("Video");e.onerror=(e=>{console.log(e.errorCode,e)}),e.onupgradeneeded=(e=>{e.target.result.createObjectStore("Video")}),e.onsuccess=(e=>{let t=e.target.result;t.transaction(["Video"],"readonly").objectStore("Video").get("Video").onsuccess=(e=>{let a=e.target.result;if(location.href.includes("#clear")){let e=t.transaction(["Video"],"readwrite");e.objectStore("Video").delete("Video");e.oncomplete=(()=>{window.onbeforeunload=null,location.href=location.href.split("#")[0]}),e.onerror=(e=>{console.log(e.errorCode,e)})}if(a)fetch(a).then(e=>{e.blob().then(e=>{a=URL.createObjectURL(e),document.getElementById("loadingMessage").hidden=!0,game=Bagel.init({id:"game",game:{assets:{videos:[{id:"Video",src:a}],imgs:[{id:"64x",src:"assets/imgs/64x.png"}]},sprites:[{id:"Background",img:"Face",scripts:{init:[{code:null,stateToRun:"game"}]},width:800,height:450},{id:"Main video",img:"Video",vars:{beats:[1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8],cloning:!0,cloningTick:0,shake:{x:0,y:0,vel:0},finalShake:!1,shaken:!1},clones:{visible:!0,scripts:{init:[e=>{let t=e.cloneID,a=e.width,o=e.height;e.width++,e.height++,e.vars.target={x:t%e.parent.vars.rowLength*a+e.width/2,y:Math.floor(t/e.parent.vars.rowLength)*o+e.height/2},e.layer.sendToBack(),e.layer.bringForwards()}],main:[e=>{if(e.vars.moving){let t=e.vars.vel,a=e.vars.target.x-e.x,o=e.vars.target.y-e.y,i=1;e.cloneID==e.parent.vars.maxClones-1&&(i=.5),a>0?t.x+=i:0!=a&&(t.x-=i),o>0?t.y+=i:0!=o&&(t.y-=i),e.x+=t.x,e.y+=t.y,t.x*=.95,t.y*=.95,a>0!=e.vars.target.x-e.x>0&&(e.x=e.vars.target.x),o>0!=e.vars.target.y-e.y>0&&(e.y=e.vars.target.y),e.vars.target.x-e.x==0&&e.vars.target.y-e.y==0&&(e.vars.moving=!1,e.vars.x=e.x,e.vars.y=e.y,e.cloneID==e.parent.vars.maxClones-1?(e.parent.vars.shake.vel+=25,e.parent.vars.finalShake=!0):e.parent.vars.shake.vel+=5)}else e.x=e.vars.x+e.parent.vars.shake.x,e.y=e.vars.y+e.parent.vars.shake.y}]},vars:{vel:{x:0,y:0},moving:!0}},scripts:{init:[{code:e=>{game.playVideo("Video",!0),e.vars.scale=e.scale},stateToRun:"game"}],main:[{code:e=>{let t=game.get.asset.video("Video").internal.video,a=Math.floor(60*t.currentTime);if(a<e.vars.beats.length)e.scale=e.vars.scale/e.vars.beats[a];else{e.vars.cloning&&(e.vars.rowLength=game.width/e.width,e.vars.maxClones=e.vars.rowLength*(game.height/e.height),e.vars.cloningTick++,15==e.vars.cloningTick&&(e.clone(),e.vars.cloningTick=0,e.cloneCount>=28&&(e.visible=!1),e.cloneCount==e.vars.maxClones&&(e.vars.cloning=!1)));let t=e.vars.shake;t.vel?(t.x=(2*Math.random()-1)*t.vel,t.y=(2*Math.random()-1)*t.vel,e.vars.finalShake?t.vel*=.9:t.vel*=.7,t.vel<.01&&(t.vel=0,e.vars.finalShake&&(e.vars.shaken=!0))):e.vars.shaken&&Math.random()<.01&&game.get.sprite("Images").clone()}},stateToRun:"game"}]},width:800,height:450},{id:"Images",clones:{vars:{imgs:["64x","Face","Video"]},visible:!0,scripts:{init:[e=>{e.img=e.vars.imgs[Math.round(Math.random()*e.vars.imgs.length)],"64x"==e.img?e.scale=1.5*Math.random()+.5:e.scale=.2*Math.random()+.05,Math.random()>.5?(e.x=game.width+e.width/2,e.vars.direction=-1):(e.x=-e.width/2,e.vars.direction=1),e.y=Math.random()*(game.height-e.height)+e.height/2,e.vars.speed=2*(Math.random()+.5)}],main:[e=>{e.x+=e.vars.direction*e.vars.speed,1==e.vars.direction?e.x<=-e.width/2&&e.delete():e.x>=game.width+e.width/2&&e.delete()}]}}}],plugins:[{src:"assets/scripts/video.js"}],scripts:{init:[{code:e=>{setInterval(()=>{e.paused=e.get.asset.video("Video").internal.video.paused},15)},stateToRun:"game"}],preload:{misc:(e,t)=>{setTimeout(()=>{e.currentFPS<45&&(e.config.display.resolution="fixed")},1e3)},tasks:[(e,t)=>{let a=e.get.asset.video("Video").internal.video;((e,t,a)=>{a.ontimeupdate=(o=>{if(a.currentTime<4.4)return void e.playVideo("Video",!1,4.4,!0);a.ontimeupdate=null;let i=document.createElement("canvas"),n=i.getContext("2d");i.width=e.width,i.height=e.height;let s=5*e.width,r=1.5*e.height;n.drawImage(a,300-s/2,300-r/2,s,r),e.set.asset.img("Face",i),e.stopVideo("Video"),t()}),e.playVideo("Video",!1,.1,!0)})(e,t,a)}]}}},config:{loading:{mode:"preload",skip:!1},display:{backgroundColour:"#202020"}},state:"game",width:800,height:450}),initPWA()})});else{Bagel.init({id:"game",width:1,height:1,config:{display:{dom:!1}},state:"game"});initPWA(),document.getElementById("uploadMessage").hidden=!1,document.ontouchstart=(()=>{document.onclick()}),document.onclick=(()=>{Bagel.upload(e=>{if(document.onclick=null,document.ontouchstart=null,window.onbeforeunload=(e=>{e.preventDefault(),e.returnValue=""}),"video/mp4"==e.split(",")[0].split(":")[1].split(";")[0]){let a=t.transaction(["Video"],"readwrite");a.objectStore("Video").put(e,"Video");document.getElementById("uploadMessage").hidden=!0;let o=document.getElementById("loadingMessage");o.innerHTML="Uploading...<br>This can take up to 10-15 seconds depending on the size.",o.hidden=!1,a.oncomplete=(()=>{window.onbeforeunload=null,location.reload()}),a.onerror=(e=>{console.log(e.errorCode,e)})}else alert("Unsupported format, mp4s are only supported."),window.onbeforeunload=null,location.reload()})})}})})}});const initPWA=()=>{Bagel.pwa.init({manifest:"manifest.json",debugManifest:"debugManifest.json",worker:"worker.js",versions:"versions.json",version:"version.txt",icons:!0,multiTabStorageName:"Mincecraft multitab",versionStorageName:"Mincecraft version",cacheStorageName:"Mincecraft cache",debug:!1,minified:!0})};
